<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>Ova Sorgu Haritası</title>

<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css">
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.7.1/jszip.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@tmcw/togeojson@5/dist/togeojson.umd.js"></script>

<style>
  body { margin:0; }
  #map { height:100vh; width:100vw; }
</style>
</head>
<body>

<div id="map"></div>

<script>
const map = L.map("map").setView([39, 35], 6);

L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png", {
    maxZoom: 19,
}).addTo(map);

let ovaLayers = []; // tüm ova poligonlarını burada tutacağız

// -------------------------------
// ZIP → KMZ → KML → GeoJSON YÜKLE
// -------------------------------
fetch("BOKA.zip")
  .then(r => r.arrayBuffer())
  .then(zipData => JSZip.loadAsync(zipData))
  .then(zip => zip.file("BOKA.kmz").async("arraybuffer"))
  .then(kmzData => JSZip.loadAsync(kmzData))
  .then(kmzZip => {
      const kmlFile = Object.keys(kmzZip.files).find(f => f.endsWith(".kml"));
      return kmzZip.file(kmlFile).async("string");
  })
  .then(kmlText => {
      const xml = new DOMParser().parseFromString(kmlText, "text/xml");
      const geojson = toGeoJSON.kml(xml);

      const layer = L.geoJSON(geojson, {
          style: {
              color: "red",
              weight: 2,
              fillOpacity: 0.15
          }
      }).addTo(map);

      ovaLayers.push(layer);

      console.log("Ova poligonları başarıyla yüklendi!");
  })
  .catch(err => {
      console.error("KMZ Okuma Hatası:", err);
      alert("KMZ yüklenemedi. ZIP içindeki dosya adının 'BOKA.kmz' olduğundan emin olun.");
  });

</script>

</body>
</html>
